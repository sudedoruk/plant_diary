{% extends "base.html" %}

{% block body %}

<style>
  /* Resim Ã¼zerine gelince el iÅŸareti Ã§Ä±ksÄ±n */
  #kucukResim:hover { opacity: 0.7; }

  /* Arka plan karartmasÄ± */
  .modal {
    display: none; 
    position: fixed; 
    z-index: 9999; 
    padding-top: 50px; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    background-color: rgba(0,0,0,0.9); 
  }

  /* BÃ¼yÃ¼k resim Ã¶zellikleri */
  .modal-icerik {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    max-height: 80vh;
    object-fit: contain; 
  }

  /* Kapatma butonu (X) */
  .kapat-tusu {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
  }
</style>

<div class="container mt-4">

    <h2 class="mb-4 text-success fw-bold">
        ğŸŒ¿ {{ plant.name }} Ait Bilgiler
    </h2>

    <div class="row">
        
        <div class="col-md-5 mb-4">
            {% if plant.photo %}
                <img id="kucukResim" 
                     src="{{ plant.photo.url }}" 
                     alt="{{ plant.name }}" 
                     class="img-fluid rounded shadow-sm border"
                     style="width: 100%; height: 350px; object-fit: cover; cursor: pointer;">
                
                <p class="text-muted text-center small mt-2">
                    (BÃ¼yÃ¼tmek iÃ§in resme tÄ±kla)
                </p>
            {% else %}
                <div class="bg-light rounded d-flex align-items-center justify-content-center border" style="height: 350px;">
                    <span class="text-muted fs-5">Resim Yok ğŸ‚</span>
                </div>
            {% endif %}
        </div>

        <div class="col-md-7">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-body">
                    
                    <h4 class="card-title text-success">{{ plant.name }}</h4>
                    <h6 class="card-subtitle mb-3 text-muted">{{ plant.species }}</h6>
                    
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <strong>ğŸ“ Konum:</strong> {{ plant.get_location_display }}
                        </li>
                        <li class="list-group-item">
                            <strong>ğŸ“… KayÄ±t Tarihi:</strong> {{ plant.added_date }}
                        </li>
                        <li class="list-group-item">
                            <strong>ğŸ’§ Sulama SÄ±klÄ±ÄŸÄ±:</strong> {{ plant.irrigation_frequency }} gÃ¼nde bir
                        </li>
                    </ul>

                    <div class="mt-4">
                        {% if request.user.is_authenticated %}
                            
                            <a href="{% url 'plant:update' plant.id %}" class="btn btn-warning text-white me-2">
                                âœï¸ Bilgileri GÃ¼ncelle
                            </a>
                            
                            <form action="{% url 'plant:delete' plant.id %}" method="POST" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Bu bitkiyi silmek istediÄŸine emin misin?')">
                                    ğŸ—‘ï¸ Sil
                                </button>
                            </form>

                        {% else %}
                            <div class="alert alert-warning">
                                ğŸ”’ DÃ¼zenleme yapmak iÃ§in giriÅŸ yapmalÄ±sÄ±n.
                            </div>
                        {% endif %}
                    </div>

                </div>
            </div>
        </div>
    </div>

    <hr class="my-5">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-primary">ğŸ“‹ BakÄ±m GeÃ§miÅŸi</h3>
        
        {% if request.user.is_authenticated %}
            <a href="{% url 'plant:carelog_create' plant.id %}" class="btn btn-primary">
                â• Yeni BakÄ±m Ekle
            </a>
        {% endif %}
    </div>

    {% if carelogs %}
        <div class="row row-cols-1 row-cols-md-2 g-3">
            {% for log in carelogs %}
            <div class="col">
                <div class="card shadow-sm border-start border-primary border-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <h6 class="fw-bold">{{ log.date }}</h6>
                            
                            <div>
                                {% if log.watered %}
                                    <span class="badge bg-info text-dark">SulandÄ±</span>
                                {% endif %}
                                {% if log.fertilized %}
                                    <span class="badge bg-warning text-dark">GÃ¼brelendi</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if log.notes %}
                            <p class="mt-2 mb-0 text-muted fst-italic">"{{ log.notes }}"</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-light border text-center">
            HenÃ¼z hiÃ§ bakÄ±m kaydÄ± girilmemiÅŸ.
        </div>
    {% endif %}

</div>

<div id="resimPenceresi" class="modal">
  <span class="kapat-tusu">&times;</span>
  <img class="modal-icerik" id="buyukResim">
</div>
<script>
  // ElemanlarÄ± seÃ§
  var modal = document.getElementById("resimPenceresi");
  var kucukResim = document.getElementById("kucukResim");
  var buyukResim = document.getElementById("buyukResim");
  var kapatTusu = document.getElementsByClassName("kapat-tusu")[0];

  // Resim varsa tÄ±klama Ã¶zelliÄŸini ekle
  if (kucukResim) {
      kucukResim.onclick = function(){
        modal.style.display = "block";
        buyukResim.src = this.src; // KÃ¼Ã§Ã¼k resmin kaynaÄŸÄ±nÄ± bÃ¼yÃ¼ÄŸe kopyala
      }
  }

  // Ã‡arpÄ±ya basÄ±nca kapat
  kapatTusu.onclick = function() { 
    modal.style.display = "none";
  }

  // Siyah boÅŸluÄŸa basÄ±nca kapat
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>

{% endblock %}

















